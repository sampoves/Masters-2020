\section{Data and methods}
\subsection{General workflow}
\justify
This chapter describes the usage of methods in this study.

\begin{itemize}
    \item Kyselytutkimuksen teko
    \item Kyselytutkimuksen toteuttaminen
    \item geoprosessointi ja visualisointien tuotto
    \item Kyselytutkimuksen tulostentutkimus
    \item Tähän upea flowchartti (methodology/data refinement process)
\end{itemize}

\subsection{Study area}
\justify
% https://www.hel.fi/hel2/Helsinginseutu/HS_tunnusluvut/liikennemaara_ja_autonomistus.pdf
% https://www.hsl.fi/sites/default/files/19_2016_auton_omistus_helsingin_seudulla.pdf
% https://www.hsl.fi/tutkimukset/muut-selvitykset
% http://pxnet2.stat.fi/PXWeb/pxweb/fi/StatFin/StatFin__lii__mkan/
The study area of this thesis is Helsinki Capital Region. It comprises of municipalities of Helsinki, Espoo, Vantaa and Kauniainen. According to \textcolor{red}{LÄHDE}, the total population of the metropolitan area is 1.495 million. In practice the whole area amalgamates as one complete functional area with borders of the municipalities indistinguishable at the street level. The HCR faces increasing pressure to manage its traffic because \textcolor{red}{LÄHDE}. Of these municipalities Helsinki is the hub, and considered to contain the only inner city features of the municipalities (\textcolor{red}{syke-urbanareas}). Espoo, Vantaa and Kauniainen are mostly made of suburban areas with occasional industrial areas and large shopping complexes placed throughout the area. The HRC is served with a high performance public transport system comprised of buses and train and tram in Helsinki. Recently the metro expanded from Helsinki to Espoo, triggering a new phase of fast evolving for the surroundings of the new stations.

Despite extensive service level of Helsinki Region public transport, households especially Espoo, Vantaa and Kauniainen remain much dependent on their personal vehicles (\textcolor{red}{LÄHDE}). 

\subsection{Data}
\justify

% hyphenrules: prevent hyphenation temporarily
\begin{hyphenrules}{nohyphenation}
    \begin{table}[H]
        \centering
        \setlength\tabcolsep{1pt}
        % One unit here is ">{\raggedright\arraybackslash}p{4cm}". \raggedright prevents justification of text and conveniently allows flush right or flush left, which is not possible with column command p{4cm} alone.
        \begin{tabular}{ @{} >{\raggedright\arraybackslash}p{4cm} >{\raggedright\arraybackslash}p{4cm} >{\raggedright\arraybackslash}p{4cm} >{\raggedleft\arraybackslash}p{2cm} @{} }
            \toprule
            \cmidrule(r){1-2}
            Data & Description & Producer & Citation \\
            \midrule
            Paavo - Open data by postal code area & Postal code areas & Statistics Finland & 2 \\
            Urban Atlas 2012 & Land use and land cover data & European Environment Agency & \cite{EuropeanEnvironmentAgency2016Urban2012} \\
            Urban areas & kaupunkialueet & Finnish Environment Institute & 1 \\
            Helsinki Region-Travel Time Matrix 2018 & matrix & Digital Geography Lab & \cite{Tenkanen2018Helsinki2018} \\
            YKR grid & Statistical grid for 250 x 250 meters & Statistics Finland & 2 \\
            \bottomrule
        \end{tabular}
        \caption{Used data} \label{tab:useddata}
    \end{table} 
\end{hyphenrules}

\subsection{Used software}
\justify

\begin{hyphenrules}{nohyphenation}
    \begin{table}[H]
        \centering
        \setlength\tabcolsep{1pt}
        \begin{tabular}{ @{} >{\raggedright\arraybackslash}p{3cm} >{\raggedright\arraybackslash}p{3cm} >{\raggedright\arraybackslash}p{3cm} >{\raggedright\arraybackslash}p{3cm} >{\raggedleft\arraybackslash}p{2cm} @{} }
            \toprule
            \cmidrule(r){1-2}
            Software & Description & Purpose in thesis & Producer & Citation \\
            \midrule
            Python 3.7.3 & programming language & geoprocessing & Pyhton & 2 \\
            R 3.6.1 & programming language & data and visualisation & R & 2 \\
            NetBeans & programming platform & survey programming & joku & 2 \\
            Leaflet 1.4.0 & library & survey & tyyppi & 2 \\
            \bottomrule
        \end{tabular}
        \caption{Used software} \label{tab:usedsoft}
    \end{table} 
\end{hyphenrules}

\subsection{Methods}
\justify

\subsubsection{Considering options for the survey}
\justify
To collect the areal parking data, the study required an interactive survey which respondents could use to submit their parking habits in a spatial fashion. To attract a maximum number of submissions, the survey also needed to be of modern design, easy to use and its purpose easy to understand. The survey would have to be clear-cut, effortless to internalise and short in length as to prevent users getting frustrated and leaving before submitting answers. Design-wise, the spatial resolution of the survey was also in question. The particular concern was that in the case of insufficient amount of answers, what kind of area delineation would be at the same time detailed enough but streamlined enough to realistically reach the good quality results. This chapter strives to describe the process that would lead to the implemented survey to accentuate the challenges this kind of research entail.

Once the consideration into options to produce the survey for this study had started, it quickly became apparent that there were few alternatives available and fewer free, customisable alternatives. Out of the proprietary options, Maptionnaire by the Finnish company Mapita was considered. They offer tailored map survey products with discounts for students. In return for the fee a subscriber receives a time window in which to carry out their survey accompanied with tailored features and customer support -- all according to the price plan. This price was considered too steep for the thesis and Maptionnaire was passed on. 

Next Survey123 for ArcGIS was evaluated. An Esri operated service, Survey123 is used to create and analyse form based surveys. It is included in the contract between University of Helsinki and Esri and thus was free to use for the study. One can design a survey at the Survey123 website and share it immediately to respondents. Alternatively, Survey123 offers a range of possibilities for customisation with its adherence to the XLSForm standard. XLSForm is a standard to make authoring forms in Excel easier. With customisability of XLSForm users can design Survey123 surveys to the dot while employing the support for Excel style scripting for complex survey behaviour. Some months were used to perfect the parking survey with Survey123. 

In January 2019 the Survey123 parking survey was deployed to friends and family, with larger scale push planned for later. At its core, this survey asked respondents for parkings in Helsinki Capital Region which actually took place. Respondents would pick an exact location on the map for the location of their parked car and separately on a separate map the location of their final destination. Respondents were asked to do this for as many times as they had the will. The survey was released even after the software had proved itself unwieldly for the purposes of this research. The software was difficult to use because of an arrangement of inconvenient design choices and multitude of bugs. It was not possible, for example, to have respondents leave multiple results at once. They would have to reload the survey, something a majority of people would not do. The desktop application of Survey123, Survey123 Connect, did not allow customisation of the post-submission message and therefore it would not be possible to efficiently direct respondents back to the form. Following the responses received by this form it was decided that the required spatial resolution for this research would need to be lower than exact points. Postal code areas were deemed a acceptable compromise in spatial accuracy. It was also not possible to achieve this goal in Survey123. A conclusive search was carried out in the Internet to find a previous survey research with similar objectives as in this thesis with the hopes to adapt one for this study. The search carried no results. 

After careful consideration it was decided that the survey would have to be programmed from scratch. The whole process of designing, creating and carrying out the survey research took several months of work.

\subsubsection{Parking survey}
\justify
To achieve maximum transparency and repeatability for this research, a survey web application was programmed from the ground up. The survey and its supporting infrastructure was installed on a virtual machine in CSC's -- the state owned ICT solutions company -- Taito supercluster. Running on the Linux distribution Ubuntu version 16.04, the backbone of the survey ecosystem was a LAMP stack, a software bundle which incorporates the Linux operating system, Apache HTTP Server (web server software), \gls{mysql} relational database management system and the PHP programming language environment for server-side scripting. The visible component of the survey is the frontend, the only component of the survey system an user would interact with.

The frontend, a web application, was programmed in JavaScript using a open-source mapping library Leaflet (software version 1.4.0) in January--May 2019. The survey was made available in English and Finnish languages. In the survey the respondent is presented with a map view of Helsinki Capital Region with its 167 postal code areas and is asked to fill out five questions about each area. User is asked to fill out as many postal code areas as they can remember parking in last two years. Last two years was chosen as the timeframe to allow the respondent to comfortably think back while also forbidding the submission of out of date parking times. All answers received are estimates as the survey is not about an exact time and place. The answers are also subject to errors made by the user. Once the user is finished with the survey, they may send them to the server side. The user can return to the survey to add data on any postal code areas they missed the last time. The survey questions are available for viewing in the appendices.

When data is received from the user, a \gls{php} language script verifies all results. This is an effort to prevent attacks on the web server running the study survey, as it is visible to the entire internet. Additionally, the verification makes sure falsified or incomplete data does not find its way to the database containing the accepted results. Only certain variables are accepted from the survey. All of the variables must be present in the received data. If the verification test fails on any of the variables, user is informed about it. In addition to the verification, a PHP script tracks IP addresses which have accessed the survey. By using the survey, respondents agree that their IP addresses are recorded for the use of this thesis solely to recognise overlapping answers and detect unique visits. All IP addresses were anonymised with a Python script and original data deleted.

As a final survey component the server side contained two MySQL datatables, one for received records (Table~\ref{tab:recordstab}) and another for survey page hits (Table~\ref{tab:visitortab}). In the table records, the following data was gathered: time of sending (timestamp), IP address (ip), postal code (zipcode), a value in the sequence 1--5 for the likert question (likert), a value in the sequence 1--4 for the question what type of parking spot was used (parkspot), an integer value for how long it usually took to park in this location (parktime), an integer value for how long it usually took to walk from parking place to one's destination (walktime) and a value in the sequence 1--4 for the question at what time of the day one usually parks in the location (timeofday). In the table records it is notable that in the case an user sends the server data for multiple postal code areas each of the postal code areas take up their own row in the data table. Consequently, it was theoretically possible for one user to simultaneously submit 167 rows of data.

In the table visitors the following data was gathered: IP address (ip), the timestamp of the first visit (ts\_first), the timestamp of latest visit (ts\_latest), the count of visits (count). In this table an IP address is only stored once. On the first visit of an IP address the row for that IP address is created in the data table with ts\_first and ts\_latest being identical. On the second visit of that IP address the original row is appended with updated information in the columns ts\_latest and count.

The survey was released to the public in May 2019 and the active phase of gathering results continued until 30th June 2019. However, the survey remained open after the active period, receiving the last response in October 2019. The majority of the respondents were found through Facebook. Invitations to participate in the survey were sent to 112 city district and neighborhood groups with a theoretical reach of tens of thousands of people. Effort was also made to get faculty members and students of University of Helsinki to participate in the survey. A small amount of answers were collected with a tweet sent from the Twitter account of Digital Geography Lab. 

The source code for the survey described in this chapter and step-by-step information to set up an identical system is available at GitHub (\textcolor{blue}{Insert link here}). As a side product, a variant of this survey was created where users pick precise points instead of areas. This precise survey template is, too, available at GitHub (\textcolor{blue}{Insert link here}).

% \scalebox to prevent table going too wide
\begin{hyphenrules}{nohyphenation}
    \begin{table}[H]
        \centering
        \setlength\tabcolsep{1pt}
        \scalebox{0.92}{\begin{tabular}{ @{} >{\raggedright\arraybackslash}p{1.5cm} >{\raggedright\arraybackslash}p{4cm} >{\raggedright\arraybackslash}p{2.5cm} >{\raggedright\arraybackslash}p{2cm} >{\raggedright\arraybackslash}p{1.5cm} >{\raggedright\arraybackslash}p{1.5cm} >{\raggedright\arraybackslash}p{1.5cm} >{\raggedright\arraybackslash}p{1.5cm} >{\raggedleft\arraybackslash}p{1.5cm} @{} }
            \toprule
            \cmidrule(r){1-2}
            id & timestamp & ip & zipcode & likert & parkspot & parktime & walktime & timeofday \\
            \midrule
            3244 & 2019-06-06 21:39:50 & wro4qo8hv4 & 00510 & 1 & 4 & 0 & 3 & 1 \\
            3245 & 2019-06-06 21:41:21 & aonm72lyx3 & 00520 & 2 & 1 & 10 & 5 & 1 \\
            3246 & 2019-06-06 21:41:54 & n1982i4i2v & 00100 & 1 & 1 & 20 & 4 & 1 \\
            3247 & 2019-06-06 21:46:19 & sbhfz0uvsl & 00210 & 1 & 1 & 5 & 3 & 3 \\
            3248 & 2019-06-06 21:46:22 & sbhfz0uvsl & 00220 & 2 & 2 & 5 & 5 & 2 \\        
            \bottomrule
        \end{tabular}}
        \caption{Records} \label{tab:recordstab}
    \end{table} 
\end{hyphenrules}

\begin{hyphenrules}{nohyphenation}
    \begin{table}[H]
        \centering
        \setlength\tabcolsep{1pt}
        \begin{tabular}{ @{} >{\raggedright\arraybackslash}p{2cm} >{\raggedright\arraybackslash}p{3cm} >{\raggedright\arraybackslash}p{4cm} >{\raggedright\arraybackslash}p{4cm} >{\raggedleft\arraybackslash}p{1cm} @{} }
            \toprule
            \cmidrule(r){1-2}
            id & ip & ts\_first & ts\_latest & count \\
            \midrule
            1780 & mvovd467a7 & 2019-05-26 15:25:23 & 2019-05-26 15:26:06 & 2 \\
            1781 & xgbgkkzxb3 & 2019-05-26 15:26:23 & 2019-05-26 15:26:23 & 1 \\
            1782 & c9qer4q99a & 2019-05-26 15:27:25 & 2019-05-26 15:27:25 & 1 \\
            1783 & cujhd0hng7 & 2019-05-26 15:27:29 & 2019-05-26 15:27:29 & 1 \\
            1784 & 3ja7gjtko6 & 2019-05-26 15:28:45 & 2019-05-26 15:29:20 & 2 \\        
            \bottomrule
        \end{tabular}
        \caption{Visitors} \label{tab:visitortab}
    \end{table} 
\end{hyphenrules}

\subsection{Processing survey data}
\justify
Lots of processing was done in Python. The source code for the data processing described in this chapter is available at GitHub (\textcolor{blue}{Insert link here}).

\subsection{Conducting analyses}
\justify
Lots of analysing was done in R. The source code for the data analysis and visualisation scripts described in this chapter are available at GitHub (\textcolor{blue}{Insert link here}).
\begin{itemize}
  \item Compare a few different travel time chains in Helsinki Capital Region. A few starting points and a few finishing points
  \item All of the statistics stuff to detect the variation 
  \item Tuuli was supposed to send me the exact numbers used for parking in Travel Time Matrix, did not do it yet
\end{itemize}